# Feature: 관리자 페이지

## 개요
관리자(role='admin') 전용 페이지. 유저 관리, 결제 내역 조회, 앱 설정 관리, 감사 로그를 제공하는 내부 운영 도구.

## 목표
- 관리자가 서비스 현황을 한눈에 파악할 수 있다
- 유저를 검색하고 역할/상태를 변경할 수 있다
- 결제 내역을 필터링하여 조회할 수 있다
- 앱 설정을 동적으로 관리할 수 있다
- 모든 관리자 액션이 감사 로그에 기록된다

## 비목표
- 관리자 계정 생성 UI (DB 직접 또는 시드로 처리)
- 실시간 알림/웹소켓
- 결제 환불 처리 (토스페이먼츠 대시보드에서 직접)

---

## 유저 스토리

### US-1: 대시보드 통계 확인
**As a** 관리자  
**I want to** 서비스 핵심 지표를 한눈에 보고 싶다  
**So that** 서비스 상태를 빠르게 파악할 수 있다

**수락 기준:**
- [ ] 총 유저 수, 오늘 가입 수, 총 매출, 이번 달 매출 4개 통계 카드 표시
- [ ] 최근 가입 유저 5명 리스트 (이름, 이메일, 가입일)
- [ ] 최근 결제 5건 리스트 (주문ID, 유저, 금액, 상태, 결제일)
- [ ] 페이지 로드 시 서버에서 데이터 조회 (Server Component)

### US-2: 유저 목록 조회 및 검색
**As a** 관리자  
**I want to** 유저 목록을 검색하고 필터링하고 싶다  
**So that** 특정 유저를 빠르게 찾을 수 있다

**수락 기준:**
- [ ] 유저 테이블: 이름, 이메일, 역할, 상태, 가입일 컬럼
- [ ] 이메일 또는 이름으로 검색 (query param `?q=`)
- [ ] 페이지네이션: 20명씩, query param `?page=`
- [ ] 총 유저 수 및 페이지 정보 표시

### US-3: 유저 역할/상태 변경
**As a** 관리자  
**I want to** 유저의 역할이나 상태를 변경하고 싶다  
**So that** 권한을 관리하고 악성 유저를 차단할 수 있다

**수락 기준:**
- [ ] 역할 변경: user ↔ admin (드롭다운 선택)
- [ ] 상태 변경: active ↔ banned (드롭다운 선택)
- [ ] 변경 시 확인 다이얼로그 표시
- [ ] 변경 후 auditLogs에 기록 (action, target, targetId, details)
- [ ] 성공/실패 토스트 메시지
- [ ] 자기 자신의 역할은 변경 불가

### US-4: 결제 내역 조회
**As a** 관리자  
**I want to** 결제 내역을 상태별로 필터링하여 보고 싶다  
**So that** 결제 현황을 파악할 수 있다

**수락 기준:**
- [ ] 결제 테이블: 주문ID, 유저 이메일, 금액, 상태, 결제수단, 결제일
- [ ] 상태 필터: 전체 / pending / paid / failed / cancelled / refunded (query param `?status=`)
- [ ] 최신순 정렬
- [ ] 페이지네이션: 20건씩
- [ ] 금액 표시 형식: ₩1,000 (toLocaleString)

### US-5: 앱 설정 관리
**As a** 관리자  
**I want to** 앱 설정을 추가/수정/삭제하고 싶다  
**So that** 런타임에 앱 동작을 제어할 수 있다

**수락 기준:**
- [ ] 설정 목록: key, value(JSON), 설명, 공개여부
- [ ] 설정 추가: key, value, description, isPublic 입력 폼
- [ ] 설정 수정: 인라인 편집 또는 모달
- [ ] 설정 삭제: 확인 다이얼로그 후 삭제
- [ ] 모든 변경은 auditLogs에 기록

---

## 접근 제어

### 인증/인가 흐름
```
요청 → 세션 확인 (Supabase Auth)
       ├─ 미인증 → /auth/login 리다이렉트
       └─ 인증됨 → DB에서 user.role 조회
                   ├─ role !== 'admin' → /dashboard 리다이렉트
                   └─ role === 'admin' → 관리자 페이지 렌더링
```

### 보안 요구사항
- Server Component에서 세션 + 역할 검증 (클라이언트 우회 불가)
- Server Action에서도 동일한 검증 수행
- CSRF 보호: Next.js 기본 Server Action 보호 사용

---

## 비기능 요구사항

### 성능
- 대시보드 통계 쿼리: 500ms 이내
- 유저/결제 목록 조회: 300ms 이내 (페이지네이션 기준)

### 접근성
- 모든 테이블에 적절한 ARIA 속성
- 키보드 네비게이션 지원
- 스크린리더 호환

### 반응형
- 데스크탑: 사이드바 + 콘텐츠 레이아웃
- 태블릿: 사이드바 접기 가능
- 모바일: 사이드바 → 상단 네비게이션 또는 햄버거 메뉴, 테이블 → 카드 뷰

### 다크모드
- 전체 관리자 UI 다크모드 지원
- 기존 ThemeProvider 활용
